(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["daoCommunity"],{"086e":function(t,n,e){t.exports=e.p+"img/usdt.27fabadb.svg"},2532:function(t,n,e){"use strict";var o=e("23e7"),s=e("5a34"),a=e("1d80"),i=e("ab13");o({target:"String",proto:!0,forced:!i("includes")},{includes:function(t){return!!~String(a(this)).indexOf(s(t),arguments.length>1?arguments[1]:void 0)}})},"44e7":function(t,n,e){var o=e("861d"),s=e("c6b6"),a=e("b622"),i=a("match");t.exports=function(t){var n;return o(t)&&(void 0!==(n=t[i])?!!n:"RegExp"==s(t))}},"4c7a":function(t,n,e){},"5a34":function(t,n,e){var o=e("44e7");t.exports=function(t){if(o(t))throw TypeError("The method doesn't accept regular expressions");return t}},"7d1b":function(t,n,e){t.exports=e.p+"img/back.d11ad5ff.svg"},"7e2d":function(t,n,e){"use strict";e.r(n);var o=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"HJZCommunity"},[o("div",{staticClass:"title"},[o("img",{attrs:{src:e("7d1b")},on:{click:function(n){return t.$router.back()}}}),o("span",[t._v("DAO")])]),o("div",{staticClass:"content"},[o("div",{staticClass:"container"},[o("div",{staticClass:"HJZCommunitySwap"},[o("div",[o("span",[t._v("USDT")]),o("span",[t._v(t._s(t.usdt.toFixed(2)))])]),t._m(0),o("div",[o("span",[t._v("PIN")]),o("span",[t._v(t._s(t.pin.toFixed(2)))])])]),o("div",{staticClass:"HJZCommunityInput"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.usdtAmount,expression:"usdtAmount"}],attrs:{type:"text",placeholder:t.$t("HJZCommunity.text4",{token:"USDT"})},domProps:{value:t.usdtAmount},on:{input:[function(n){n.target.composing||(t.usdtAmount=n.target.value)},function(n){return t.inputAmount(!0)}]}}),o("span",[t._v("+")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.pinAmount,expression:"pinAmount"}],attrs:{type:"text",placeholder:"0.0000",disabled:""},domProps:{value:t.pinAmount},on:{input:[function(n){n.target.composing||(t.pinAmount=n.target.value)},function(n){return t.inputAmount(!1)}]}})]),o("div",{staticClass:"get-power"},[o("span",[t._v("获得AI算力 "),o("span",[t._v(t._s(t.aiPower))])]),o("span",[t._v("获得PIN算力 "),o("span",[t._v(t._s(t.pinPower))])])]),o("van-button",{directives:[{name:"ButClickLimit",rawName:"v-ButClickLimit"}],attrs:{disabled:t.btnDisabled,loading:"none"!=t.state,"loading-text":t.btnText},on:{click:t.sendTrade}},[t._v(t._s(t.btnText))])],1)])])},s=[function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",[o("img",{attrs:{src:e("086e")}}),o("img",{attrs:{src:e("f48e")}})])}],a=(e("caad"),e("a9e3"),e("d3b7"),e("25f0"),e("2532"),e("96cf"),e("1da1")),i={computed:{btnText:function(){return Number(this.usdtAmount)<=0?this.$t("HJZCommunity.text13"):"approving"===this.state?this.usdtAllowance<Number(this.usdtAmount)?this.$t("HJZCommunity.text23"):this.$t("HJZCommunity.text24",{token:"PIN"}):"trading"===this.state?this.$t("HJZCommunity.text25"):this.usdtAllowance<Number(this.usdtAmount)||0===this.usdtAllowance?this.$t("HJZCommunity.text9",{token:"USDT"}):this.pinAllowance<Number(this.pinAmount)||0===this.pinAllowance?this.$t("HJZCommunity.text9",{token:"PIN"}):this.$t("HJZCommunity.text13")},btnDisabled:function(){return Number(this.usdtAmount)<=0||"none"!==this.state}},data:function(){return{usdt:0,pin:0,usdtAmount:"",pinAmount:"",usdtAllowance:0,pinAllowance:0,state:"none",aiPower:0,pinPower:0,decimals:0,myQuota:0,show:!1,toWho:this.$t("HJZCommunity.text20"),disabled:!1,Myself:this.$t("HJZCommunity.text20"),Other:this.$t("HJZCommunity.text21"),isStart:!1}},created:function(){this.$daoContracts&&this.init()},methods:{init:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.$daoContracts.Mine.methods.usdPerPowerE12().call({from:t.$address},(function(t,n){t||console.log("1U =",n.fromWei(12))})),e=new t.$web3.BatchRequest,e.add(t.$daoContracts.Community.methods.isStart().call.request({from:t.$address})),e.add(t.$daoContracts.USDTMock.methods.balanceOf(t.$address).call.request({from:t.$address})),e.add(t.$daoContracts.PINMock.methods.balanceOf(t.$address).call.request({from:t.$address})),e.add(t.$daoContracts.USDTMock.methods.allowance(t.$address,t.$daoContracts.Community._address).call.request({from:t.$address})),e.add(t.$daoContracts.PINMock.methods.allowance(t.$address,t.$daoContracts.Community._address).call.request({from:t.$address})),e.add(t.$daoContracts.Community.methods.myQuota().call.request({from:t.$address})),e.requestManager.sendBatch(e.requests,(function(n,e){n||(t.isStart=(e[0].result?e[0].result:e[0]).decode(["bool"]),t.usdt=e[1].result.decode(["uint256"]).fromWei(),t.pin=e[2].result.decode(["uint256"]).fromWei(),t.usdtAllowance=e[3].result.decode(["uint256"]).fromWei(),t.pinAllowance=e[4].result.decode(["uint256"]).fromWei(),t.myQuota=e[5].result.fromWei().toBN().div(2))}));case 9:case"end":return n.stop()}}),n)})))()},inputAmount:function(){var t=this;if(Number(this.usdtAmount)<=0)return this.pinAmount="",this.aiPower=0,this.pinPower=0,!1;this.$daoContracts.Community.methods.convertInfo(this.usdtAmount.toWei()).call({from:this.$address},(function(n,e){n?(console.log(n),t.statu="",t.usdtAmount="",t.pinAmount="",t.aiPower=0,t.pinPower=0):(t.pinAmount=e.pinAmount.fromWei(),t.aiPower=e.power_dao,t.pinPower=e.power_pin)}))},approve:function(){var t=this;if(this.usdtAmount.toBN().gt(this.usdt))return vant.Toast.fail(this.$t("HJZCommunity.text15",{token:"USDT"}));if(this.usdtAmount.toBN().lt(1))return vant.Toast.fail(this.$t("HJZCommunity.text26",{token:"USDT"}));var n=this.usdtAllowance<Number(this.usdtAmount)?this.$daoContracts.USDTMock:this.$daoContracts.PINMock,e=this.usdtAllowance<Number(this.usdtAmount)?this.usdtAmount.toBN().times(10).toString().toWei():this.pinAmount.toBN().times(10).toString().toWei();n.methods.approve(this.$daoContracts.Community._address,e).send({from:this.$address}).on("transactionHash",(function(n){t.state="approving"})).on("receipt",function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(o){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.methods.allowance(t.$address,t.$daoContracts.Community._address).call({from:t.$address});case 2:s=e.sent,t.usdtAllowance<Number(t.usdtAmount)?t.usdtAllowance=s.fromWei():t.pinAllowance=s.fromWei(),t.state="none";case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).on("error",(function(n){vant.Toast.fail(t.$t("HJZCommunity.text27")),t.state="none"}))},sendTrade:function(){return this.isStart?this.btnText.includes("授权")?this.approve():this.convert():vant.Toast.fail("合约暂未生效！")},convert:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.usdtAmount.toBN().gt(t.usdt)){n.next=4;break}return n.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text15",{token:"USDT"})));case 4:if(!t.usdtAmount.toBN().lt(1)){n.next=8;break}return n.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text26",{token:"USDT"})));case 8:if(!t.pinAmount.toBN().gt(t.pin)){n.next=12;break}return n.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text15",{token:"PIN"})));case 12:if(!t.usdtAmount.toBN().gt(t.myQuota)){n.next=14;break}return n.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text17")));case 14:e=t.$daoContracts.Community.methods.convert(t.usdtAmount.toWei()),e.call({from:t.$address},(function(n,o){n?console.log(n):e.send({from:t.$address}).on("transactionHash",(function(n){t.state="trading"})).on("receipt",(function(n){t.state="none",t.usdtAmount="",t.pinAmount="",t.aiPower=0,t.pinPower=0,t.init(),t.$getBalance(),vant.Toast.success(t.$t("HJZCommunity.text18"))})).on("error",(function(n){vant.Toast.fail(t.$t("HJZCommunity.text29")),t.state="none"}))}));case 16:case"end":return n.stop()}}),n)})))()}}},r=i,u=r,d=(e("a9f9"),e("2877")),c=Object(d["a"])(u,o,s,!1,null,"3ee9dfd9",null);n["default"]=c.exports},a9f9:function(t,n,e){"use strict";e("4c7a")},ab13:function(t,n,e){var o=e("b622"),s=o("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[s]=!1,"/./"[t](n)}catch(o){}}return!1}},caad:function(t,n,e){"use strict";var o=e("23e7"),s=e("4d64").includes,a=e("44d2"),i=e("ae40"),r=i("indexOf",{ACCESSORS:!0,1:0});o({target:"Array",proto:!0,forced:!r},{includes:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),a("includes")},f48e:function(t,n,e){t.exports=e.p+"img/PinToken.300a986b.svg"}}]);