(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["daoPower"],{"044d":function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"b",(function(){return i}));n("99af"),n("d3b7"),n("96cf");var r=n("1da1"),a=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var n,r,a,s=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:10,r=s.length>2&&void 0!==s[2]?s[2]:0,a=JSON.stringify({query:"query addressInfomations {\n            addressInfomations(\n                skip: ".concat(r,"\n                first: ").concat(n,'\n                where: {\n                    parent: "').concat(e,'"\n                }\n                orderDirection: desc\n            ) {\n                owner\n                buredAmount\n            }\n        }')}),t.next=5,o(a);case 5:return t.abrupt("return",t.sent.data.addressInfomations);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),s=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var n,r,a,s=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:10,r=s.length>2&&void 0!==s[2]?s[2]:0,a=JSON.stringify({query:"query daoPowerEvents {\n            daoPowerEvents(\n                skip: ".concat(r,"\n                first: ").concat(n,'\n                where: {\n                    owner: "').concat(e,'"\n                }\n                orderDirection: desc\n            ) {\n                time\n                isAdd\n                amount\n                powerSource\n            }\n        }')}),t.next=5,o(a);case 5:return t.abrupt("return",t.sent.data.daoPowerEvents);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),i=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var n,r,a,s=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:10,r=s.length>2&&void 0!==s[2]?s[2]:0,a=JSON.stringify({query:"query mineDrawEvents {\n            mineDrawEvents(\n                skip: ".concat(r,"\n                first: ").concat(n,'\n                where: {\n                    owner: "').concat(e,'"\n                }\n                orderDirection: desc\n            ) {\n                time\n                amount\n            }\n        }')}),t.next=5,o(a);case 5:return t.abrupt("return",t.sent.data.mineDrawEvents);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function o(t){return u.apply(this,arguments)}function u(){return u=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,fetch("http://minister.qytech.org:8000/subgraphs/name/ai_dao/subgraph",{cache:"reload",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:e}).then((function(t){return t.json()}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),u.apply(this,arguments)}},"7d1b":function(t,e,n){t.exports=n.p+"img/back.d11ad5ff.svg"},c477:function(t,e,n){"use strict";n("cf2f")},c8b4:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"Computingpower"},[r("div",{staticClass:"title"},[r("img",{attrs:{src:n("7d1b")},on:{click:function(e){return t.$router.back()}}}),r("span",[t._v(t._s(t.$t("pickuprecord.text4")))])]),r("div",{staticClass:"content"},[r("div",{staticClass:"container"},[r("span",{staticClass:"subtitle"},[t._v(t._s(t.$t("Computingpower.text1")))]),r("div",{staticClass:"middle"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.quantitys,expression:"quantitys"}],attrs:{placeholder:t.$t("Computingpower.text3"),type:"text"},domProps:{value:t.quantitys},on:{input:[function(e){e.target.composing||(t.quantitys=e.target.value)},t.input]}}),r("van-button",{on:{click:t.maximum}},[t._v(t._s(t.$t("Computingpower.text4")))])],1),r("span",{staticClass:"power"},[t._v(t._s(t.$t("Computingpower.text2"))+" "+t._s(t.myPower))]),r("span",{staticClass:"subtitle"},[t._v(t._s(t.$t("Computingpower.text7")))]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.acceptaddress,expression:"acceptaddress"}],attrs:{placeholder:t.$t("Computingpower.text8"),type:"text"},domProps:{value:t.acceptaddress},on:{input:function(e){e.target.composing||(t.acceptaddress=e.target.value)}}}),r("div",{staticClass:"getComputingpower"},[r("div",{directives:[{name:"show",rawName:"v-show",value:t.isshow,expression:"isshow"}],staticClass:"Transferout"},[r("span",[t._v(t._s(t.$t("Computingpower.text5")))]),r("span",[t._v("1%")])]),r("div",{directives:[{name:"show",rawName:"v-show",value:!t.isshow,expression:"!isshow"}],staticClass:"getComputingpower1"},[r("span",[t._v(t._s(t.$t("Computingpower.text6")))]),r("span",[t._v(t._s(t.Available))])])]),r("van-button",{on:{click:t.Transferout}},[t._v(t._s(t.$t("Computingpower.text9")))])],1)]),r("div",{staticClass:"Detail"},[t._v(t._s(t.$t("Computingpower.text10")))]),r("div",{staticClass:"record"},[r("div",{staticClass:"content"},[r("div",[r("span",[t._v(t._s(t.$t("Computingpower.text11")))]),r("span",[t._v(t._s(t.$t("Computingpower.text12")))]),r("span",[t._v(t._s(t.$t("Computingpower.text13")))])]),t._l(t.list,(function(e){return r("div",{key:e,staticClass:"item"},[r("span",[t._v(t._s(e.time))]),r("span",[t._v(t._s(e.type))]),r("span",[t._v(t._s(e.amount))])])}))],2)])])},a=[],s=(n("99af"),n("d81d"),n("a9e3"),n("96cf"),n("1da1")),i=n("044d"),o={data:function(){return{show:!0,isshow:!0,quantitys:"",myPower:0,Available:0,acceptaddress:"",list:[],isStart:!1}},created:function(){this.$daoContracts&&this.init()},methods:{init:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=new t.$web3.BatchRequest,n.add(t.$daoContracts.Mine.methods.isStart().call.request({from:t.$address})),n.add(t.$daoContracts.Mine.methods.mineInfo().call.request({from:t.$address})),n.add(t.$daoContracts.Pledge.methods.getMinerInfo(0).call.request({from:t.$address})),n.add(t.$daoContracts.Shareholders.methods.pledgeInfo(t.$address).call.request({from:t.$address})),n.requestManager.sendBatch(n.requests,(function(e,n){if(!e){var r=n[1].result.decode([{name:"myPower",type:"uint256"},{name:"mined",type:"uint256"}]),a=r.myPower,s=n[2].result.decode([{name:"pledgeLp",type:"uint256"},{name:"gainPower",type:"uint256"}]),i=s.gainPower,o=n[3].result.decode([{name:"lpAmount",type:"uint256"},{name:"totalPower",type:"uint256"},{name:"lpAmountPerUSD",type:"uint256"},{name:"lpAmountPerPIN",type:"uint256"}]),u=o.totalPower;t.isStart=("string"===typeof n[0]?n[0]:n[0].result).decode(["bool"]),t.myPower=Number(a)-Number(i)-Number(u)}})),Object(i["c"])(t.$address).then((function(e){t.list=e.map((function(e){var n=e.isAdd?"+":"-",r="";switch(e.powerSource){case"Transfer":r=t.$t("Computingpower.text1".concat(e.isAdd?9:8));break;case"Pledge":r=t.$t("Computingpower.text".concat(e.isAdd?16:20));break;case"Community":r="DAO";break;case"Share":r=t.$t("Computingpower.text14");break;case"Holder":r=t.$t("Computingpower.text2".concat(e.isAdd?6:7));break}return{type:r,amount:"".concat(n).concat(e.amount),time:t.$toTime(e.time,"Y/M/D")}}))}));case 7:case"end":return e.stop()}}),e)})))()},maximum:function(){this.quantitys=this.myPower,this.input()},input:function(){var t=parseInt(this.quantitys,10);t!=this.quantitys?(this.quantitys="",this.isshow=!0):null!=this.quantitys&&(this.isshow=!1),this.Available=Math.floor(.99*this.quantitys)},Transferout:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.isStart){e.next=4;break}return e.abrupt("return",vant.Toast.fail("合约暂未生效！"));case 4:if(!(Number(t.quantitys)<=0)){e.next=8;break}return e.abrupt("return",vant.Toast.fail(t.$t("Computingpower.text21")));case 8:if(!(Number(t.quantitys)>Number(t.myPower))){e.next=12;break}return e.abrupt("return",vant.Toast.fail(t.$t("Computingpower.text22")));case 12:if(t.$web3.utils.isAddress(t.acceptaddress)){e.next=14;break}return e.abrupt("return",vant.Toast.fail(t.$t("Computingpower.text23")));case 14:n=t.$daoContracts.Mine.methods.transfer(t.acceptaddress,t.quantitys),n.call({from:t.$address},(function(e,r){e||n.send({from:t.$address}).on("transactionHash",(function(e){vant.Toast.loading({message:t.$t("transaction.text7"),forbidClick:!0,duration:0,loadingType:"spinner"})})).on("receipt",(function(e){t.init(),vant.Toast.clear(),t.acceptaddress="",t.quantitys="",t.isshow=!0,vant.Toast.success(t.$t("Computingpower.text25"))})).on("error",(function(e){vant.Toast.clear(),vant.Toast.fail(t.$t("transaction.text13"))}))}));case 16:case"end":return e.stop()}}),e)})))()}}},u=o,c=u,p=(n("c477"),n("2877")),d=Object(p["a"])(c,r,a,!1,null,"3f6e514e",null);e["default"]=d.exports},cf2f:function(t,e,n){},d81d:function(t,e,n){"use strict";var r=n("23e7"),a=n("b727").map,s=n("1dde"),i=n("ae40"),o=s("map"),u=i("map");r({target:"Array",proto:!0,forced:!o||!u},{map:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);