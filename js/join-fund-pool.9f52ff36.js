(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["join-fund-pool"],{"0abd":function(t,e,n){"use strict";n("869d")},1500:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"join-fund-pool"},[o("mk-navbar",{attrs:{title:t.$t("joinFundPool.text1")}}),o("div",{staticClass:"container-box"},[o("div",{staticClass:"form-container"},[o("div",{staticClass:"tokens"},[o("div",{staticClass:"token"},[t._m(0),o("span",{domProps:{textContent:t._s(t.$t("joinFundPool.text2"))}}),o("span",[t._v(t._s(t.trx))])]),o("div",{staticClass:"logos"},[o("img",{attrs:{src:n("90bd")}}),o("img",{directives:[{name:"show",rawName:"v-show",value:t.tokenInfo.tokenLogoUrl,expression:"tokenInfo.tokenLogoUrl"}],attrs:{src:t.tokenInfo.tokenLogoUrl}})]),o("div",{staticClass:"token"},[o("div",{staticClass:"symbol select",on:{click:t.openSearch}},[o("span",[t._v(t._s(t.tokenInfo.tokenSymbol||t.$t("joinFundPool.text3")))]),o("img",{attrs:{src:n("716f")}})]),o("span",{domProps:{textContent:t._s(t.$t("joinFundPool.text2"))}}),o("span",[t._v(t._s(t.token))])])]),o("div",{staticClass:"inputs"},[o("van-field",{attrs:{type:"number",placeholder:t.$t("joinFundPool.text4")},on:{input:t.inputTRX},model:{value:t.assets1,callback:function(e){t.assets1=e},expression:"assets1"}}),o("span",[t._v("+")]),o("van-field",{attrs:{type:"number",placeholder:t.$t("joinFundPool.text4")},on:{input:t.inputToken},model:{value:t.assets2,callback:function(e){t.assets2=e},expression:"assets2"}})],1),o("div",{staticClass:"rate"},[o("div",[o("span",{directives:[{name:"show",rawName:"v-show",value:!t.rateChanged,expression:"!rateChanged"}]},[t._v(t._s(t.$t("joinFundPool.text5"))+" 1TRX = "+t._s(t.rate)+t._s(t.tokenInfo.tokenSymbol))]),o("span",{directives:[{name:"show",rawName:"v-show",value:t.rateChanged,expression:"rateChanged"}]},[t._v(t._s(t.$t("joinFundPool.text5"))+" 1"+t._s(t.tokenInfo.tokenSymbol)+" = "+t._s(t.rate)+"TRX")]),o("img",{attrs:{src:n("1b07")},on:{click:t.switchRate}})]),o("span",[t._v(t._s(t.$t("joinFundPool.text6"))+" "+t._s(t.prop))])]),o("van-button",{attrs:{type:"info"},on:{click:t.addLiquidity}},[t._v(t._s(t.$t("joinFundPool.text7")))])],1),t._l(t.list,(function(e){return o("div",{key:e.address,staticClass:"your-share"},[o("div",{staticClass:"title"},[o("div",{staticClass:"text"},[o("span",{domProps:{textContent:t._s(t.$t("joinFundPool.text8"))}}),o("span",[t._v(t._s(e.myShare)+"%")])]),o("div",{staticClass:"collection"},[o("van-icon",{attrs:{name:"star-o"}}),o("span",{domProps:{textContent:t._s(t.$t("joinFundPool.text9"))}})],1)]),o("div",{staticClass:"tokens"},[o("div",{staticClass:"logos"},[o("img",{attrs:{src:n("90bd")}}),o("img",{attrs:{src:e.logo}})]),o("span",[t._v("TRX/"+t._s(e.symbol))])]),o("div",{staticClass:"redemption"},[o("div",{staticClass:"text"},[o("span",[t._v("TRX "+t._s(e.trx))]),o("span",[t._v(t._s(e.symbol)+" "+t._s(e.token))]),o("span",[t._v(t._s(t.$t("joinFundPool.text10"))+" "+t._s(e.lp))])]),o("van-button",{attrs:{type:"info"},on:{click:function(n){t.$router.push({path:"/redemption",query:{info:JSON.stringify(e)}})}}},[t._v(t._s(t.$t("joinFundPool.text11")))])],1)])}))],2),o("search-tokens",{ref:"searchTokens",on:{select:t.select}})],1)},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"symbol"},[n("span",[t._v("TRX")])])}],a=(n("99af"),n("4de4"),n("d81d"),n("a9e3"),n("b680"),n("d3b7"),n("25f0"),n("96cf"),n("1da1")),r=n("aca7"),i=n("a981"),u=n("3952"),c={components:{"mk-navbar":function(){return Promise.all([n.e("join-fund-pool~transaction"),n.e("join-fund-pool")]).then(n.bind(null,"0861"))},"search-tokens":function(){return Promise.all([n.e("join-fund-pool~transaction"),n.e("join-fund-pool")]).then(n.bind(null,"bab4"))}},data:function(){return{assets1:"",assets2:"",list:[],tokenInfo:{},trx:"--",token:"--",rate:"--",prop:"--",exTrxBalance:0,exTokenBalace:0,totalLiquidity:0,contract:null,trxInputing:!1,tokenInputing:!1,allowance:0,rateChanged:!1}},created:function(){this.$utils&&this.init()},methods:{openSearch:function(){this.$refs.searchTokens.open()},select:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var o,s,a,r,u,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=t.token,"TRX"!==o.tokenSymbol){n.next=3;break}return n.abrupt("return",vant.Toast.fail(e.$t("joinFundPool.text12")));case 3:return e.tokenInfo=o,e.contract=tronWeb.contract(i,o.address),n.next=7,e.$utils.call({contractAddress:o.tokenAddress,method:"balanceOf(address)",parameter:[{type:"address",value:e.$address}]});case 7:return e.token=n.sent.constant_result[0].decode(["uint256"]).toString().fromSun(o.tokenDecimal).toFixed(2),n.next=10,e.$utils.call({contractAddress:"TCNYd8L5hBey9FwPpvgtvDaY2cHjMFVLZu",method:"getSingleInfo(address,address)",parameter:[{type:"address",value:e.$address},{type:"address",value:o.tokenAddress}]});case 10:s=n.sent.constant_result[0].decode(["address","uint256","uint256","uint256","uint256","uint256","uint256","uint256"],["_exchangeAddr","_allowance","_exTokenBalace","_exTrxBalance","_totalLiquidity","_userUniAmount","_userTrxAmount","_userTokenAmount"]),a=s._exTrxBalance,r=s._exTokenBalace,u=s._totalLiquidity,c=s._allowance,e.exTrxBalance=a.toString().toBN(),e.exTokenBalace=r.toString().toBN(),e.totalLiquidity=u.toString().toBN(),e.allowance=c.toString().fromSun(o.tokenDecimal),e.rate="1".toSun().toBN().multipliedBy(e.exTokenBalace).div(e.exTrxBalance).toString().fromSun(e.tokenInfo.tokenDecimal);case 20:case"end":return n.stop()}}),n)})))()},addLiquidity:function(){var t=this;if(this.trx<Number(this.assets1))return vant.Toast.fail("TRX"+this.$t("joinFundPool.text13"));if(this.token<Number(this.assets2))return vant.Toast.fail("".concat(this.tokenInfo.tokenSymbol).concat(this.$t("joinFundPool.text13")));if(this.allowance<Number(this.assets2))return this.approve();var e=Math.floor((new Date).getTime()/1e3)+600;this.contract.addLiquidity(this.assets1.toSun().toBN().div(this.exTrxBalance).multipliedBy(this.totalLiquidity).toFixed(0),this.assets1.toSun().toBN().multipliedBy(this.exTokenBalace).div(this.exTrxBalance).toFixed(0),e).send({callValue:this.assets1.toSun()}).then((function(e){return t.$loading(e)}))},approve:function(){var t=this,e=tronWeb.contract(u,this.tokenInfo.tokenAddress);e.approve(this.tokenInfo.address,this.assets2.toSun(this.tokenInfo.tokenDecimal)).send().then(function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(n){var o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$loading(n);case 2:if(o=e.sent,!o){e.next=9;break}return e.next=6,t.$utils.call({contractAddress:t.tokenInfo.tokenAddress,method:"allowance(address,address)",parameter:[{type:"address",value:t.$address},{type:"address",value:t.tokenInfo.address}]});case 6:t.allowance=e.sent.constant_result[0].decode(["uint256"]).toString().fromSun(t.tokenInfo.tokenDecimal),console.log(t.allowance),t.addLiquidity();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},switchRate:function(){if(!this.tokenInfo.address)return vant.Toast.fail(this.$t("joinFundPool.text14"));this.rateChanged=!this.rateChanged,this.rateChanged?this.rate="1".toSun(this.tokenInfo.tokenDecimal).toBN().multipliedBy(this.exTrxBalance).div(this.exTokenBalace).toString().fromSun().toFixed(6):this.rate="1".toSun().toBN().multipliedBy(this.exTokenBalace).div(this.exTrxBalance).toString().fromSun(this.tokenInfo.tokenDecimal)},inputTRX:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.tokenInputing){e.next=2;break}return e.abrupt("return",t.tokenInputing=!1);case 2:if(""!==t.assets1){e.next=6;break}return t.assets2="",t.prop="--",e.abrupt("return",!1);case 6:t.trxInputing=!0,n=setTimeout(Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.assets1.length>0&&(t.assets2=t.assets1.toSun().toBN().multipliedBy(t.exTokenBalace).div(t.exTrxBalance).toString().fromSun(t.tokenInfo.tokenDecimal).toFixed(t.tokenInfo.tokenDecimal)),clearTimeout(n);case 2:case"end":return e.stop()}}),e)}))),1e3),o=t.assets1.toSun().toBN(),t.prop="".concat(o.div(t.exTrxBalance.plus(o)).multipliedBy("100".toBN()).toString().toFixed(6),"%");case 10:case"end":return e.stop()}}),e)})))()},inputToken:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.trxInputing){e.next=2;break}return e.abrupt("return",t.trxInputing=!1);case 2:if(""!==t.assets2){e.next=6;break}return t.assets1="",t.prop="--",e.abrupt("return",!1);case 6:t.tokenInputing=!0,n=setTimeout(Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.assets2.length>0&&(t.assets1=t.assets2.toSun(t.tokenInfo.tokenDecimal).toBN().multipliedBy(t.exTrxBalance).div(t.exTokenBalace).toString().fromSun().toFixed(6)),clearTimeout(n);case 2:case"end":return e.stop()}}),e)}))),1e3),o=t.assets1.toSun().toBN(),t.prop="".concat(o.div(t.exTrxBalance.plus(o)).multipliedBy("100".toBN()).toString().toFixed(6),"%");case 10:case"end":return e.stop()}}),e)})))()},init:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,o,s,a,i,u,c,l,d,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.$route.query,n.token&&t.select({token:JSON.parse(n.token)}),e.next=4,tronWeb.trx.getBalance(t.$address);case 4:return t.trx=e.sent.fromSun().toFixed(2),e.next=7,Object(r["c"])(t.$address);case 7:return o=e.sent.data.liquidityList.filter((function(t){return t.jswapBalance>0})),s=o.map((function(t){return t.address})),e.next=11,t.$utils.call({contractAddress:"TCNYd8L5hBey9FwPpvgtvDaY2cHjMFVLZu",method:"getPool(address,address[])",parameter:[{type:"address",value:t.$address},{type:"address[]",value:s}]});case 11:for(a=e.sent.constant_result[0].decode(["uint256[]","uint256[]","uint256[]","uint256[]"],["_token","_trx","_uniToken","_totalsupply"]),i=a._token,u=a._trx,c=a._uniToken,l=a._totalsupply,d=[],p=0;p<s.length;p++)d.push({logo:o[p].tokenLogoUrl,symbol:o[p].tokenSymbol,token:i[p].toString().fromSun(o[p].tokenDecimal),trx:u[p].toString().fromSun(),lp:c[p].toString().fromSun(),myShare:c[p].toString().toBN().div(l[p].toString().toBN()).multipliedBy("100".toBN()).toString().toFixed(2),address:o[p].address,tokenAddress:o[p].tokenAddress,tokenDecimal:o[p].tokenDecimal});t.list=d;case 19:case"end":return e.stop()}}),e)})))()}}},l=c,d=l,p=(n("0abd"),n("2877")),m=Object(p["a"])(d,o,s,!1,null,"34c49214",null);e["default"]=m.exports},"869d":function(t,e,n){}}]);